#!/bin/bash

if [ -z "$1" ]; then
    echo
    echo '    Usage: create_experimental_default_inifiles initype first_experiment [last_experiment] [output_dir]'
    echo
    echo '    If output_dir not specified, as default will be used the inifilename prefix'
    echo
    exit 0
fi

INIFILES_DIR='.'
DEFAULTS_DIR="$INIFILES_DIR/defaults"
DATA_DIR='data'

inifile_type="$1"
first_experiment="$2"

OUTPUT_DIR="$4"

if [ -z "$3" ]; then
    only_one=true
    last_experiment=$first_experiment
else 
    only_one=false
    last_experiment="$3"
fi

function adapt_default_inifile {
    # $1 - ini_filename_prefix_ini, $2 - experiment_number, $3 - data_filename_prefix

    filename="${OUTPUT_DIR}/${1}-exp_${2}.ini"
    
    cp "${DEFAULTS_DIR}/${1}-default.ini" "$filename"

    sed -i "s/\[exp_no\]/${2}/g" "$filename"
    sed -i "s/\[inidirectory\]/${DATA_DIR}/g" "$filename"
    sed -i "s/\[filename\]/${3}/g" "$filename"

    echo 'Generated file: '$filename
}

case "$inifile_type" in
    'is' | 'inverse_saturated')

	ini_filename_prefix='inverse_saturated_heights'
	data_filename_prefix='saturated_heights'

	if [ -z "$OUTPUT_DIR" ]; then
	    OUTPUT_DIR="${INIFILES_DIR}/${ini_filename_prefix}"
	fi

	;;
    *)
	echo 'Unknown inifile type: '$inifile_type

	exit 0
esac

mkdir -p "$OUTPUT_DIR"


if $only_one; then
    adapt_default_inifile "$ini_filename_prefix" "$first_experiment" "$data_filename_prefix"
else
    for (( i=$first_experiment; i<=$last_experiment; i++ ))
    do
	adapt_default_inifile "$ini_filename_prefix" "$i" "$data_filename_prefix"
    done
fi

exit 0